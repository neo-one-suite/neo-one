# neotracker/neo-one-circleci-node:12.9.0-1 2019-08-27
FROM neotracker/neo-one-circleci-node@sha256:6f76ab22882896c057d9d805955892f1dee26bb1a4257a6d095d07d617aa4d5c as builder
RUN mkdir -p /tmp/neo-one
WORKDIR /tmp/neo-one

COPY rush.json LICENSE README.md ./
COPY common/config common/config/
COPY common/scripts common/scripts/
COPY packages packages/

RUN sudo node common/scripts/install-run-rush.js install
RUN sudo node common/scripts/install-run-rush.js rebuild -t @neo-one/node-bin

# node:12.9.0-buster-slim 2019-08-27
FROM node@sha256:d1cfeb3cc51782d51336e34bd477c5b1b46b32e5f49cd1c3829ef52f0a5250df AS production
RUN mkdir -p /neo-one
WORKDIR /neo-one
COPY --from=builder /tmp/neo-one/packages/neo-one-utils packages/neo-one-utils/
COPY --from=builder /tmp/neo-one/packages/neo-one-client-common packages/neo-one-client-common/
COPY --from=builder /tmp/neo-one/packages/neo-one-client-full-common packages/neo-one-client-full-common/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-core packages/neo-one-node-core/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-vm packages/neo-one-node-vm/
COPY --from=builder /tmp/neo-one/packages/neo-one-client-switch packages/neo-one-client-switch/
COPY --from=builder /tmp/neo-one/packages/neo-one-client-core packages/neo-one-client-core/
COPY --from=builder /tmp/neo-one/packages/neo-one-react-core packages/neo-one-react-core/
COPY --from=builder /tmp/neo-one/packages/neo-one-logger-config packages/neo-one-logger-config/
COPY --from=builder /tmp/neo-one/packages/neo-one-client-full-core packages/neo-one-client-full-core/
COPY --from=builder /tmp/neo-one/packages/neo-one-react packages/neo-one-react/
COPY --from=builder /tmp/neo-one/packages/neo-one-react-common packages/neo-one-react-common/
COPY --from=builder /tmp/neo-one/packages/neo-one-logger packages/neo-one-logger/
COPY --from=builder /tmp/neo-one/packages/neo-one-cli-common packages/neo-one-cli-common/
COPY --from=builder /tmp/neo-one/packages/neo-one-cli-common-node packages/neo-one-cli-common-node/
COPY --from=builder /tmp/neo-one/packages/neo-one-http packages/neo-one-http/
COPY --from=builder /tmp/neo-one/packages/neo-one-http-context packages/neo-one-http-context/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-rpc-handler packages/neo-one-node-rpc-handler/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-consensus packages/neo-one-node-consensus/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-storage-common packages/neo-one-node-storage-common/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-blockchain packages/neo-one-node-blockchain/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-http-rpc packages/neo-one-node-http-rpc/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-network packages/neo-one-node-network/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-offline packages/neo-one-node-offline/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-protocol packages/neo-one-node-protocol/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-storage-levelup packages/neo-one-node-storage-levelup/
COPY --from=builder /tmp/neo-one/packages/neo-one-node packages/neo-one-node/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-neo-settings packages/neo-one-node-neo-settings/
COPY --from=builder /tmp/neo-one/packages/neo-one-utils-node packages/neo-one-utils-node/
COPY --from=builder /tmp/neo-one/packages/neo-one-node-bin packages/neo-one-node-bin/
COPY --from=builder /tmp/neo-one/common/temp/node_modules common/temp/node_modules/
ENTRYPOINT ["/usr/local/bin/node", "packages/neo-one-node-bin/bin/neo-one-node.js"]
